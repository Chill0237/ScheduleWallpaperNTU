<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        :root {
            --primary: #2196F3;
            --success: #4CAF50;
            --danger: #dc3545;
            --text-dark: #333;
            --text-grey: #555;
            --border: #e0e0e0;
            --bg-light: #f8f9fa;
            --anim-speed: 0.2s;
        }

        body {
            width: 780px; height: 550px; margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light); color: var(--text-dark);
            box-sizing: border-box;
        }
        *, *:before, *:after { box-sizing: border-box; }

        .main-layout { display: flex; height: 100%; overflow: hidden; }
        
        .left-panel {
            width: 270px; background: #e9ecef;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px; box-shadow: inset -5px 0 10px rgba(0,0,0,0.05);
        }
        .canvas-container {
            width: 216px; height: 470px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-radius: 12px; overflow: hidden;
            background: white; border: 4px solid #333;
        }
        canvas { width: 100%; height: 100%; object-fit: contain; }
        .preview-hint {
            margin-top: 15px; font-size: 12px; color: #888;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .right-panel {
            display: flex; flex-direction: column;
            flex: 1; height: 100%; padding: 20px;
            background: white; overflow: hidden;
        }

        .warning-bar {
            background-color: #fff3cd; color: #856404;
            padding: 8px 12px; border-radius: 6px;
            font-size: 13px; margin-bottom: 10px;
            border: 1px solid #ffeeba;
            display: flex; align-items: center; gap: 8px;
            animation: fadeIn 0.3s ease;
        }
        .warning-bar a { color: #856404; font-weight: bold; text-decoration: underline; }
        .hidden { display: none !important; }

        .tab-nav {
            display: flex; margin-bottom: 10px;
            background: #f0f0f0; padding: 4px;
            border-radius: 8px; flex-shrink: 0;
        }
        .tab-btn {
            flex: 1; border: none; background: transparent;
            padding: 6px; cursor: pointer; font-size: 14px;
            color: #666; border-radius: 6px; transition: all 0.2s;
        }
        .tab-btn.active {
            background: #fff; color: #333;
            font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .tab-content {
            display: none; flex-direction: column;
            overflow: hidden; flex: 1; min-height: 0;
        }
        .tab-content.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(2px); } to { opacity: 1; transform: translateY(0); } }

        .control-group { overflow-y: auto; padding-right: 5px; } 
        .control-row {
            height: 37px; display: flex; gap: 15px;
            align-items: center; margin-bottom: 5px;
        }
        .control-item {
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .flex-1 { flex: 1; } .flex-2 { flex: 2; } .flex-4 { flex: 4; }
        label { font-size: 13px; font-weight: 600; color: var(--text-grey); white-space: nowrap; }
        h3 { margin: 0; font-size: 14px; color: #555; }

        .modern-select {
            width: 100%; padding: 6px 10px; padding-right: 25px;
            border: 1px solid var(--border); border-radius: 6px;
            background: white; font-size: 13px; appearance: none; cursor: pointer;
        }
        .select-wrapper { position: relative; width: 100%; max-width: 120px; }
        .select-arrow {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            font-size: 10px; color: #999; pointer-events: none;
        }
        
        .modern-range { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
        .modern-range:focus { outline: none; }
        .modern-range::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e0e0e0; border-radius: 2px; }
        .modern-range::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px;
            border-radius: 50%; background: var(--primary); margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: transform 0.1s ease;
        }
        .modern-range:active::-webkit-slider-thumb { transform: scale(1.1); }
        .modern-range:disabled { opacity: 0.5; cursor: not-allowed; }

        .circle-color-wrapper {
            position: relative; width: 28px; height: 28px;
            border-radius: 50%; overflow: hidden;
            border: 1px solid #ddd; cursor: pointer;
        }
        .circle-color-input {
            position: absolute; top: -50%; left: -50%;
            width: 200%; height: 200%; border: none; padding: 0; cursor: pointer;
        }

        .course-list-scroll {
            flex: 1; overflow-y: auto; border: 1px solid #eee;
            border-radius: 8px; padding: 5px; background: #fafafa;
        }
        .course-item {
            display: flex; align-items: center; gap: 8px;
            padding: 8px; margin-bottom: 4px;
            border-bottom: 1px solid #eee; background: #fff; border-radius: 6px;
        }
        .course-info { flex: 1; overflow: hidden; display: flex; flex-direction: column; gap: 4px;}
        .course-original-name { display: block; font-size: 10px; color: #999; margin-bottom: 2px; }
        
        .input-alias {
            width: 100%; border: none; border-bottom: 1px solid #ddd;
            background: transparent !important; margin: 0; font-size: 13px; padding: 2px 0;
        }
        .input-alias:focus { outline: none; border-bottom-color: var(--primary); }
        .input-room-alias::placeholder { color: #aaa; font-size: 11px; }

        .manual-section {
            border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 10px;
        }
        .manual-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
        }
        .manual-list {
            display: flex; flex-direction: column; gap: 6px; max-height: 120px; overflow-y: auto;
        }
        .manual-item {
            display: flex; gap: 6px; align-items: center; background: #fff; padding: 4px; border-radius: 4px; border: 1px solid #eee;
        }
        .btn-mini {
            padding: 4px 8px; font-size: 12px; border: none; border-radius: 4px; cursor: pointer; color: white;
        }
        .btn-mini-add { background-color: var(--success); }
        .btn-mini-del { background-color: #ccc; color: #fff; width: 24px; height: 24px; padding: 0; display: flex; align-items: center; justify-content: center; font-weight: bold;}
        .btn-mini-del:hover { background-color: var(--danger); }

        .action-area { margin-top: 10px; flex-shrink: 0; }
        #status { font-size: 12px; color: #666; margin-bottom: 5px; text-align: right; height: 16px; }
        .btn-row { display: flex; gap: 10px; }
        .btn-success {
            flex: 2; padding: 12px; border: none; border-radius: 8px;
            background: var(--success); color: white; font-weight: bold; cursor: pointer;
        }
        .btn-danger {
            flex: 1; padding: 12px; border: none; border-radius: 8px;
            background: var(--danger); color: white; font-weight: bold; cursor: pointer;
        }
        .btn-success:hover, .btn-danger:hover { filter: brightness(0.95); transform: translateY(-1px); }

        .checkbox-container { display: inline-block; position: relative; width: 36px; height: 20px; cursor: pointer; }
        .checkbox-container input { display: none; }
        .checkmark { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 20px; }
        .checkmark:before { content: ""; position: absolute; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; border-radius: 50%; transition: 0.2s; }
        .checkbox-container input:checked + .checkmark { background-color: var(--primary); }
        .checkbox-container input:checked + .checkmark:before { transform: translateX(16px); }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="left-panel">
            <div class="canvas-container">
                <canvas id="wallpaperCanvas" width="1080" height="2400"></canvas>
            </div>
            <div class="preview-hint">預覽模式</div>
        </div>

        <div class="right-panel">
            <div id="warning-bar" class="warning-bar hidden">
                <span>⚠️ 無法抓取新課表，目前顯示舊紀錄。<a href="https://course.ntu.edu.tw/result/final/table" target="_blank">前往課程網</a>開啟選課結果頁面。</span>
            </div>

            <div class="tab-nav">
                <button class="tab-btn active" data-target="tab-global">排版設定</button>
                <button class="tab-btn" data-target="tab-course">顏色設定</button>
            </div>

            <div id="tab-global" class="tab-content active">
                <div class="control-group">
                    <div class="control-row">
                        <div class="control-item flex-1">
                            <label>起始星期</label>
                            <div class="select-wrapper">
                                <select id="startDay" class="modern-select">
                                    <option value="1" selected>一</option><option value="2">二</option><option value="3">三</option>
                                    <option value="4">四</option><option value="5">五</option><option value="6">六</option>
                                </select><div class="select-arrow">▼</div>
                            </div>
                        </div>
                        <div class="control-item flex-1">
                            <label>結束星期</label>
                            <div class="select-wrapper">
                                <select id="endDay" class="modern-select">
                                    <option value="1">一</option><option value="2">二</option><option value="3">三</option>
                                    <option value="4">四</option><option value="5" selected>五</option><option value="6">六</option>
                                </select><div class="select-arrow">▼</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1">
                            <label>起始節數</label>
                            <div class="select-wrapper">
                                <select id="startNum" class="modern-select">
                                    <option value="0">0</option><option value="1" selected>1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">A</option><option value="12">B</option><option value="13">C</option><option value="14">D</option>
                                </select><div class="select-arrow">▼</div>
                            </div>
                        </div>
                        <div class="control-item flex-1">
                            <label>結束節數</label>
                            <div class="select-wrapper">
                                <select id="endNum" class="modern-select">
                                    <option value="0">0</option><option value="1" selected>1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">A</option><option value="12">B</option><option value="13">C</option><option value="14">D</option>
                                </select><div class="select-arrow">▼</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>顯示課名</label><label class="checkbox-container"><input type="checkbox" id="showClassName" checked><span class="checkmark"></span></label></div>
                        <div class="control-item flex-4"><label>大小</label><input type="range" id="classNameSize" class="modern-range" min="0" max="100" value="24"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>顯示星期</label><label class="checkbox-container"><input type="checkbox" id="showWeekTitle" checked><span class="checkmark"></span></label></div>
                        <div class="control-item flex-4"><label>大小</label><input type="range" id="weekTitleSize" class="modern-range" min="0" max="100" value="35"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>顯示教室</label><label class="checkbox-container"><input type="checkbox" id="showClassroom" checked><span class="checkmark"></span></label></div>
                        <div class="control-item flex-4"><label>大小</label><input type="range" id="classroomSize" class="modern-range" min="0" max="80" value="20"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>顯示時間</label><label class="checkbox-container"><input type="checkbox" id="showTime" checked><span class="checkmark"></span></label></div>
                        <div class="control-item flex-4"><label>大小</label><input type="range" id="timeSize" class="modern-range" min="0" max="70" value="35"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>上方留白</label><input type="range" id="paddingTop" class="modern-range" min="0" max="1200" step="10" value="250"></div>
                        <div class="control-item flex-1"><label>下方留白</label><input type="range" id="paddingBottom" class="modern-range" min="0" max="1200" step="10" value="100"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>左右留白</label><input type="range" id="paddingX" class="modern-range" min="0" max="500" step="5" value="40"></div>
                        <div class="control-item flex-1"><label>文字對齊</label><input type="range" id="textAlign" class="modern-range" min="0" max="2" step="1" value="0"></div>
                    </div>
                    <div class="control-row">
                        <div class="control-item flex-1"><label>文字垂直位置</label><input type="range" id="textOffsetY" class="modern-range" min="0" max="100" step="1" value="50"></div>
                        <div class="control-item flex-1"><label>圓角大小</label><input type="range" id="borderRadius" class="modern-range" min="0" max="40" step="1" value="12"></div>
                    </div>
                </div>
            </div>

            <div id="tab-course" class="tab-content">
                <div class="control-group">
                    <div class="control-row">
                        <div class="control-item flex-1">
                            <label>背景顏色</label>
                            <div class="circle-color-wrapper" title="全域背景"><input type="color" id="bgColor" class="circle-color-input" value="#fdfbf7"></div>
                        </div>
                        <div class="control-item flex-1">
                            <label>字體顏色</label>
                            <div class="circle-color-wrapper" title="全域字體"><input type="color" id="textColor" class="circle-color-input" value="#2c3e50"></div>
                        </div>
                        <div class="control-item flex-2">
                            <label>快速套用主題</label>
                            <div class="select-wrapper" style="width: 100%;">
                                <select id="themeSelect" class="modern-select">
                                    <option value="" disabled selected>請選擇...</option>
                                    <option value="pastel">粉彩</option>
                                    <option value="cool">冷色</option>
                                    <option value="dark">暗黑</option>
                                    <option value="morandi">莫蘭迪</option>
                                    <option value="nature">大自然</option>
                                    <option value="retro">復古</option>
                                    <option value="neon">霓虹</option>
                                    <option value="coffee">咖啡</option>
                                </select><div class="select-arrow">▼</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="manual-section">
                    <div class="manual-header">
                        <h3>自訂時段 (手動新增)</h3>
                        <button id="btn-add-manual" class="btn-mini btn-mini-add">＋ 新增</button>
                    </div>
                    <div id="manual-course-list" class="manual-list">
                        <div style="text-align:center; color:#999; font-size:12px; padding:10px;">點擊上方按鈕新增課程</div>
                    </div>
                </div>

                <div class="control-group" style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
                    <h3>個別設定 (配色與顯示名稱)</h3>
                    <div id="course-list-container" class="course-list-scroll">
                        <div style="text-align:center; color:#999; padding:20px;">尚未抓取資料</div>
                    </div>
                </div>
            </div>

            <div class="action-area">
                <div id="status"></div>
                <div class="btn-row">
                    <button id="btn-reset" class="btn-danger">恢復預設</button>
                    <button id="btn-download" class="btn-success">下載圖片</button>
                </div>
            </div>
        </div>
    </div>
    <script src="popup.js"></script>
</body>
</html>